{"filter":false,"title":"BookController.php","tooltip":"/cms/app/Http/Controllers/BookController.php","undoManager":{"mark":2,"position":2,"stack":[[{"start":{"row":0,"column":0},"end":{"row":173,"column":1},"action":"insert","lines":["<?php","","namespace App\\Http\\Controllers;","","use Illuminate\\Http\\Request;","use App\\Models\\Book;","use App\\Models\\User;","use Validator;","use Auth;","","class BookController extends Controller","{","    /**","     * Display a listing of the resource.","     *","     * @return \\Illuminate\\Http\\Response","     */","    public function index()","    {","        $books = Book::orderBy('created_at', 'asc')->get();","        return view('books', ['books' => $books]);","    }","","    /**","     * Show the form for creating a new resource.","     *","     * @return \\Illuminate\\Http\\Response","     */","    public function create()","    {","        //","    }","","    /**","     * Store a newly created resource in storage.","     *","     * @param  \\Illuminate\\Http\\Request  $request","     * @return \\Illuminate\\Http\\Response","     */","    public function store(Request $request)","    {","\t\t// バリデーション","\t    $validator = Validator::make($request->all(), [","\t        'item_text'   => 'required | min:3 | max:255',","\t       // 'item_number' => 'required | min:1 | max:3',","\t       // 'item_amount' => 'required | max:6',","\t       // 'published'   => 'required',","\t    ]);","","\t\t\t// バリデーション:エラー時の処理","\t    if ($validator->fails()) {","\t        return redirect('/')","\t            ->withInput()","\t            ->withErrors($validator);","\t    }","\t    ","\t    $file = $request->file('item_img');//file取得","\t    if(!empty($file)){                 //fileが空かチェック","\t        $filename = $file->getClientOriginalName();//ファイル名を取得","\t        $move = $file->move('./upload/',$filename);//ファイルを異動：パスが\"./upload/\"の場合もあるcloud9","\t        }else{","\t            $filename = \"\";","\t        }","\t\t","    \t\t// 登録処理","            $book = new Book;","            $book->user_id =  Auth::id();","            $book->item_text = $request->item_text;","            $book->item_img = $filename;","            // $book->file_name =    $request->file_name;","            // $book->item_number =  $request->item_number;","            // $book->item_amount =  $request->item_amount;","            // $book->published =    $request->published;","            ","            ","            ","            $book->save();","            return redirect('/');","         ","    }","","    /**","     * Display the specified resource.","     *","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function show($id)","    {","        //","    }","","    /**","     * Show the form for editing the specified resource.","     *","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function edit(Book $book)","    {","        if($book->user_id === Auth::id()){","            return view('booksedit', ['book' => $book]);","        } else {","        return \"アクセス権がありません\";","        }","    }","","    /**","     * Update the specified resource in storage.","     *","     * @param  \\Illuminate\\Http\\Request  $request","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function update(Request $request)","    {","\t\t// バリデーション","\t\t$validator = Validator::make($request->all(), [","\t\t    'id' => 'required', // storeに対しての追加分","\t\t    'item_text' => 'required|min:3|max:255',","\t\t  //  'item_number' => 'required|min:1|max:3',","\t\t  //  'item_amount' => 'required|max:6',","\t\t  //  'published' => 'required',","\t\t]);","","\t\t// バリデーション:エラー","\t\tif ($validator->fails()) {","\t\t    return redirect('/booksedit/'.$request->id)","\t\t        ->withInput()","\t\t        ->withErrors($validator);","\t\t}","","        $book = Book::where('user_id', Auth::id())->find($request->id);","        $book->item_text =    $request->item_text;","        // $book->item_number =  $request->item_number;","        // $book->item_amount =  $request->item_amount;","        // $book->published =    $request->published;","        $book->save(); ","        return redirect('/');","    }","","    /**","     * Remove the specified resource from storage.","     *","     * @param  int  $id","     * @return \\Illuminate\\Http\\Response","     */","    public function destroy(Book $book)","    {","        $book->delete();","        return redirect('/');","    }","    ","    // お気に入り（多対多）","    public function likeBook(Book $book)","    {","    \t\t$book->favoriteBook()->attach(Auth::id());","    \t\treturn back();","    }","    ","    public function unlikeBook(Book $book)","    {","        $book->favoriteBook()->detach(Auth::id());","        return back();","    }","    ","    // 管理者ページ ※便宜的にBookコントローラーに作成","\tpublic function adminIndex()","\t{","\t\t// 1対多の複数の例","\t\t$users = User::with('books')->get();","\t\treturn view('admin', ['users' => $users]);","\t}","}"],"id":4}],[{"start":{"row":156,"column":5},"end":{"row":156,"column":6},"action":"remove","lines":["\t"],"id":5}],[{"start":{"row":157,"column":5},"end":{"row":157,"column":6},"action":"remove","lines":["\t"],"id":6}]]},"ace":{"folds":[],"scrolltop":2493,"scrollleft":0,"selection":{"start":{"row":163,"column":22},"end":{"row":163,"column":22},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":51,"state":"php-start","mode":"ace/mode/php"}},"timestamp":1650337042726,"hash":"0b1c75dc469a74cd5bff8d95f676eff88fb635bd"}